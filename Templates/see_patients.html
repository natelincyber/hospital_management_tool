{% extends 'base.html' %}

{% block head %}
<style>
</style>

{% endblock %}

{% block title %}See Patients{% endblock %}


{% block body %}
    {% if see_patients|length == 0 %}
        <p style="white-space:pre-wrap">You have no patients. Go to the add patient menu to add a new patient!</p>
    {% else %}
        <br>    
        <div>
            <h1 style="display:inline">All Patients</h1>
        </div>
        <hr>
        <table class="table table-striped" style="text-align: center;">
            <thead class="thead-dark">
            <tr>
                <th scope="col">Medical Identification</th>
                <th scope="col">Patient</th>
                <th scope="col">Gender</th>
                <th scope="col">Age</th>
                <th scope="col">Date Admitted</th>
                <th scope="col">Patient Discharge Date</th>
                <th scope="col">Department</th>
                <th scope="col">Doctor ID</th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody>
                {% for patient in see_patients %}

                    <tr>
                        <th scope="row" class="align-middle" >
                            {% if patient.medID %}
                                {{ patient.medID }}
                            {% else %}
                                -
                            {% endif %}
                        </th>

                        {% if patient.firstName and patient.lastName and patient.medID %}
                            <td class="align-middle">{{ patient.firstName }} {{ patient.lastName }}</td>
                        {% else %}
                            <td class="align-middle">-</td>
                        {% endif %}

                        {% if patient.gender %}
                            <td class="align-middle">{{ patient.gender }}</td>
                        {% else %}
                            <td class="align-middle">-</td>
                        {% endif %}

                        {% if patient.age %}
                            <td class="align-middle">{{ patient.age }}</td>
                        {% else %}
                            <td class="align-middle">-</td>
                        {% endif %}

                        {% if patient.date_admitted %}
                            <td class="align-middle">{{ patient.date_admitted.date() }}</td>
                        {% else %}
                            <td class="align-middle">-</td>
                        {% endif %}


                        {% if patient.state == '2' %}
                            {% set cureDate = 7 %}
                        {% elif patient.state == '3' %}
                            {% set cureDate = 30 %}
                        {% elif patient.state == '1' %}
                            {% if patient.cureTime == '' %}
                                <meta http-equiv="refresh" content="0; /new_patient_error/{{ patient.id }}" />
                            {% else %}
                                {% set cureDate = patient.cureTime|int %}
                            {% endif %}
                        {% elif patient.state == '2' or '3' %}
                            {% if patient.cureTime|int == 123 %}
                                <meta http-equiv="refresh" content="0; /new_patient_error/{{ patient.id }}" />
                            {% endif %}
                        {% else %}
                            {% set nullVal = '-' %}
                        {% endif %}

                        {% set dischargeTime1 = patient.date_admitted.strftime("%m-%d-%Y") %}

                        {% set month1 = dischargeTime1[1:2] %}

                        {% set year1 = dischargeTime1[6:] %}

                        {% set month = month1|int %}

                        {% set year = year1|int %}

                        {% set dischargeTime = dischargeTime1[3:5] %}

                        {% set dischargeTimeNum = dischargeTime|int %}

                        {% if nullVal %}
                            <td class="align-middle">-</td>
                        {% else %}
                            {% set finalDay = dischargeTimeNum + cureDate %}'
            
                            {% if month == 1 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 2 %}
                                {% if year % 4 == 0%}
                                    {% if year % 100 == 0 %}
                                        {% if year % 400 == 0 %}
                                            {% set numDays = 29 %}
                                        {% else %}
                                            {% set numDays = 28 %}
                                        {% endif %}
                                    {% else %}
                                        {% set numDays = 29 %}
                                    {% endif %}
                                {% else %}
                                    {% set numDays = 28 %}
                                {% endif %}

                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}  
                            {% endif %}

                            {% if month == 3 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 4 %}
                                {% set numDays = 30 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 5 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}
                            
                            {% if month == 6 %}
                                {% set numDays = 30 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 7 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}
                            
                            {% if month == 8 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 9 %}
                                {% set numDays = 30 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 10 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 11 %}
                                {% set numDays = 30 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = month + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}

                            {% if month == 12 %}
                                {% set numDays = 31 %}
                                {% if finalDay > numDays %}
                                    {% set overflow = finalDay - numDays %}
                                    {% set month = 1 %}
                                    {% set year = year + 1 %}
                                    {% set finalDay = 0 %}
                                    {% set finalDay = finalDay + overflow %}
                                {% endif %}
                            {% endif %}
                            <td class="align-middle">{{ year}}-{{ month }}-{{finalDay}}</td>
                        {% endif %}

                            
                        {% if patient.field %}
                            <td class="align-middle" style="padding:0 0px 0 0px;">{{ patient.field }}</td>
                        {% else %}
                            <td class="align-middle">-</td>
                        {% endif %}

                        {% if patient.doctorID %}
                            <td class="align-middle">{{ patient.doctorID }}</td>
                        {% else %}
                            <td class="align-middle">-</td>
                        {% endif %}

                        <td class="align-middle"><a class='btn btn-primary btn-sm' href='/see_patients/edit/{{ patient.id }}'><img src="/static/edit.png"></a><a class='btn btn-danger btn-sm' href='/see_patients/delete/{{ patient.id }}'><img src="/static/trash.png"></a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}  


{% endblock %}